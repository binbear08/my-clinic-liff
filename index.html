<!DOCTYPE html>
<html>
<head>
Â  <meta charset="utf-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>à¸£à¸°à¸šà¸šà¸ˆà¸­à¸‡à¸„à¸´à¸§à¸„à¸¥à¸´à¸™à¸´à¸</title>
Â  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
Â  Â  Â  padding: 20px;
Â  Â  Â  background: #f4f5f7;
Â  Â  Â  color: #333;
Â  Â  Â  margin: 0;
Â  Â  }
Â  Â  .container {
Â  Â  Â  max-width: 450px;
Â  Â  Â  margin: 0 auto;
Â  Â  }
Â  Â  .form-box {
Â  Â  Â  background: #fff;
Â  Â  Â  padding: 25px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
Â  Â  }
Â  Â  h2 {
Â  Â  Â  text-align: center;
Â  Â  Â  color: #06C755; /* LINE Green */
Â  Â  Â  margin-top: 0;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  label {
Â  Â  Â  display: block;
Â  Â  Â  margin: 12px 0 6px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: #555;
Â  Â  }
Â  Â  input, select {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 12px;
Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  box-sizing: border-box; /* Important for padding */
Â  Â  Â  font-size: 16px;
Â  Â  }
Â  Â  button {
Â  Â  Â  background: #06C755;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  padding: 14px;
Â  Â  Â  width: 100%;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: background-color 0.3s;
Â  Â  }
Â  Â  button:hover {
Â  Â  Â  background: #05a546;
Â  Â  }
Â  Â  button:disabled {
Â  Â  Â  background: #ccc;
Â  Â  Â  cursor: not-allowed;
Â  Â  }
Â  Â  #status {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-top: 15px;
Â  Â  Â  font-weight: bold;
Â  Â  }
Â  Â  .success { color: #06C755; }
Â  Â  .error { color: #ff4d4f; }
Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <div class="form-box">
Â  Â  Â  <h2>à¸ˆà¸­à¸‡à¸„à¸´à¸§à¸à¸šà¹à¸à¸—à¸¢à¹Œ</h2>
Â  Â  Â  <label for="patientName">à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢</label>
Â  Â  Â  <input type="text" id="patientName" placeholder="à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥">

Â  Â  Â  <label for="doctor">à¹€à¸¥à¸·à¸­à¸à¹à¸à¸—à¸¢à¹Œ</label>
Â  Â  Â  <select id="doctor">
Â  Â  Â  Â  <option value="à¸«à¸¡à¸­à¸ªà¸¡à¸Šà¸²à¸¢">à¸™à¸²à¸¢à¹à¸à¸—à¸¢à¹Œà¸ªà¸¡à¸Šà¸²à¸¢</option>
Â  Â  Â  Â  <option value="à¸«à¸¡à¸­à¸ªà¸¡à¸«à¸à¸´à¸‡">à¹à¸à¸—à¸¢à¹Œà¸«à¸à¸´à¸‡à¸ªà¸¡à¸«à¸à¸´à¸‡</option>
Â  Â  Â  </select>

Â  Â  Â  <label for="date">à¸§à¸±à¸™à¸—à¸µà¹ˆ</label>
Â  Â  Â  <input type="date" id="date">

Â  Â  Â  <label for="time">à¹€à¸§à¸¥à¸²</label>
Â  Â  Â  <input type="time" id="time">

Â  Â  Â  <button id="submitBtn" onclick="bookQueue()">à¸ˆà¸­à¸‡à¸„à¸´à¸§</button>
Â  Â  Â  <div id="status"></div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  // --- à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹à¸à¹‰à¹„à¸‚ ---
Â  Â  const LIFF_ID = "2007785068-1gROkD8p"; // ğŸ‘‰ à¹ƒà¸ªà¹ˆ LIFF ID à¸‚à¸­à¸‡à¸„à¸¸à¸“
Â  Â  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz_8RuH-u9C3ebxij7utz4jLjOKP0yD96qxPc7KXxsK29N_FuopPrEypzFdOx1eaEFmtw/exec"; // ğŸ‘‰ à¹ƒà¸ªà¹ˆ Web App URL à¸‚à¸­à¸‡à¸„à¸¸à¸“

Â  Â  // --- à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸³à¸«à¸£à¸±à¸šà¹ƒà¸Šà¹‰à¸‡à¸²à¸™ ---
Â  Â  const submitBtn = document.getElementById('submitBtn');
Â  Â  const statusDiv = document.getElementById('status');
Â  Â  const dateInput = document.getElementById('date');
Â  Â  let userId = '';
    let isLiffReady = false; // à¹€à¸à¸´à¹ˆà¸¡à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸–à¸²à¸™à¸° LIFF

Â  Â  /**
Â  Â  Â * à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™
Â  Â  Â */
Â  Â  window.onload = async function() {
Â  Â  Â  statusDiv.textContent = 'à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥...';
Â  Â  Â  submitBtn.disabled = true;

Â  Â  Â  // à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸§à¸±à¸™à¸—à¸µà¹ˆà¸‚à¸±à¹‰à¸™à¸•à¹ˆà¸³à¹€à¸›à¹‡à¸™à¸§à¸±à¸™à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™à¹€à¸ªà¸¡à¸­
Â  Â  Â  const today = new Date();
Â  Â  Â  today.setMinutes(today.getMinutes() - today.getTimezoneOffset());
Â  Â  Â  dateInput.min = today.toISOString().split('T')[0];

      // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² `liff` à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¸ˆà¸£à¸´à¸‡à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
      if (typeof liff !== 'undefined' && liff.init) {
        try {
          await liff.init({ liffId: LIFF_ID });

          if (!liff.isLoggedIn()) {
            // à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹à¸ªà¸”à¸‡ error à¹à¸•à¹ˆà¹ƒà¸«à¹‰à¸à¸²à¹„à¸›à¸«à¸™à¹‰à¸² login à¹€à¸¥à¸¢
            statusDiv.textContent = 'à¸à¸£à¸¸à¸“à¸²à¸¥à¹‡à¸­à¸à¸­à¸´à¸™à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸Šà¹‰à¸‡à¸²à¸™';
            liff.login({ redirectUri: window.location.href });
          } else {
            const profile = await liff.getProfile();
            userId = profile.userId;
            document.getElementById('patientName').value = profile.displayName;
            isLiffReady = true;
            statusDiv.textContent = '';
            submitBtn.disabled = false;
          }
        } catch (err) {
          console.error(err);
          statusDiv.className = 'error';
          statusDiv.textContent = 'à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸¥à¸” LIFF';
        }
      } else {
        // à¸à¸£à¸“à¸µà¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹€à¸›à¸´à¸”à¹ƒà¸™à¹à¸­à¸› LINE (à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¸›à¸à¸•à¸´)
        console.log('à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹ƒà¸™ LIFF environment');
        statusDiv.textContent = ''; // à¸¥à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ªà¸–à¸²à¸™à¸°à¸­à¸­à¸
        submitBtn.disabled = false;
      }
Â  Â  };

Â  Â  /**
Â  Â  Â * à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ˆà¸­à¸‡à¸„à¸´à¸§à¹€à¸¡à¸·à¹ˆà¸­à¸à¸”à¸›à¸¸à¹ˆà¸¡
Â  Â  Â */
Â  Â  async function bookQueue() {
Â  Â  Â  // à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸à¸Ÿà¸­à¸£à¹Œà¸¡
Â  Â  Â  const patientName = document.getElementById('patientName').value.trim();
Â  Â  Â  const doctor = document.getElementById('doctor').value;
Â  Â  Â  const date = dateInput.value;
Â  Â  Â  const time = document.getElementById('time').value;

Â  Â  Â  // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸£à¸šà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
Â  Â  Â  if (!patientName || !doctor || !date || !time) {
Â  Â  Â  Â  statusDiv.className = 'error';
Â  Â  Â  Â  statusDiv.textContent = 'à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¹‰à¸„à¸£à¸šà¸—à¸¸à¸à¸Šà¹ˆà¸­à¸‡';
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // à¸›à¸´à¸”à¸›à¸¸à¹ˆà¸¡à¹à¸¥à¸°à¹à¸ªà¸”à¸‡à¸ªà¸–à¸²à¸™à¸°
Â  Â  Â  submitBtn.disabled = true;
Â  Â  Â  statusDiv.className = '';
Â  Â  Â  statusDiv.textContent = 'à¸à¸³à¸¥à¸±à¸‡à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¸ˆà¸­à¸‡...';

Â  Â  Â  // à¹€à¸•à¸£à¸µà¸¢à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸ˆà¸°à¸ªà¹ˆà¸‡à¹„à¸› Google Apps Script
Â  Â  Â  const payload = {
        patientName,
        doctor,
        date,
        time,
        userId: isLiffReady ? userId : '' // à¸ªà¹ˆà¸‡ userId à¹€à¸‰à¸à¸²à¸°à¹€à¸¡à¸·à¹ˆà¸­à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ LIFF à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
      };

Â  Â  Â  try {
Â  Â  Â  Â  const response = await fetch(WEB_APP_URL, {
Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  headers: { "Content-Type": "text/plain;charset=utf-8" },
Â  Â  Â  Â  Â  body: JSON.stringify(payload),
Â  Â  Â  Â  Â  redirect: "follow"
Â  Â  Â  Â  });

Â  Â  Â  Â  const resultText = await response.text();
Â  Â  Â  Â  const result = JSON.parse(resultText);

Â  Â  Â  Â  if (result.status === "OK") {
Â  Â  Â  Â  Â  statusDiv.className = 'success';
Â  Â  Â  Â  Â  statusDiv.textContent = `âœ… à¸ˆà¸­à¸‡à¸„à¸´à¸§ #${result.queueNo} à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢!`;
Â  Â  Â  Â  Â  // à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸•à¹ˆà¸²à¸‡ LIFF à¸«à¸²à¸à¹€à¸›à¸´à¸”à¸ˆà¸²à¸ LINE
          if (isLiffReady) {
            statusDiv.textContent += ` à¸£à¸°à¸šà¸šà¹„à¸”à¹‰à¸ªà¹ˆà¸‡à¸šà¸±à¸•à¸£à¸„à¸´à¸§à¹„à¸›à¹ƒà¸«à¹‰à¸„à¸¸à¸“à¹ƒà¸™ LINE à¹à¸¥à¹‰à¸§`;
            setTimeout(() => {
              liff.closeWindow();
            }, 3000);
          }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  throw new Error(result.message || 'à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸ˆà¸­à¸‡à¸„à¸´à¸§à¹„à¸”à¹‰');
Â  Â  Â  Â  }

Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  statusDiv.className = 'error';
Â  Â  Â  Â  statusDiv.textContent = "âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”: " + err.message;
Â  Â  Â  Â  submitBtn.disabled = false; // à¹€à¸›à¸´à¸”à¸›à¸¸à¹ˆà¸¡à¹ƒà¸«à¹‰à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆà¹„à¸”à¹‰
Â  Â  Â  }
Â  Â  }
Â  </script>
</body>
</html>
